----------------------------------------------------------------------------------------

ver.2.2.2を持ちまして、一時的な更新も終了となりました。
バグ報告をしてくださった方には非常に感謝しております。

----------------------------------------------------------------------------------------

※ソースコードのコンパイルについて

作成環境は Cygwin + PSPSDK (revision 2326) です。
おそらくそれ以前の環境でもコンパイルは可能だと思われますが、出来る限り
最新の環境を使っていただくのが望ましいと思います。

※このソースファイルのアーカイブを解凍して出来たフォルダ構造は変更しないで
  ください。変更するとMakefileの修正が必要になります。

コンパイルの際は、Makefileの先頭にあるConfigurationの項目を編集することで
コンパイルの対象を設定します。各項目の先頭に#をつけてコメントアウトする
ことで無効に、#を削除することで有効になります。以下詳細です。


・コンパイルの設定

BUILD_CPS1PSP = 1      CPS1PSPのコンパイルを行います。

BUILD_CPS2PSP = 1      CPS2PSPのコンパイルを行います。

BUILD_MVSPSP = 1       MVSPSPのコンパイルを行います。

BUILD_NCDZPSP = 1      NCDZPSPのコンパイルを行います。

PSP_SLIM = 1           PSP-2000 + CFW3.71 M33以降用のユーザーモードで実行
                       するバイナリをコンパイルします。

KERNEL_MODE = 1        FW1.5のカーネルモードで実行するバイナリを作成します。

SAVE_STATE = 1         ステートセーブ/ロード機能を組み込みます。

ADHOC = 1              AdHoc通信対戦機能をくみこみます。(KERNEL_MODEを有効に
                       している場合のみ)

COMMAND_LIST = 1       コマンドリスト機能を組み込みます。

JAPANESE_UI = 1        日本語ユーザインタフェース版を作成します。

UI_32BPP = 1           ユーザインタフェースの描画を32bitカラーで行います。
                       壁紙も使用可能になりますが、NCDZPSP以外ではメモリの
                       消費を抑えるためにもこのフラグは無効にしておくほうが
                       良いです。

RELEASE = 1            有効にするとREREASE = 1を、無効にするとRELEASE = 0を
                       コンパイルの定数として設定します。
                       ソース中で #if RELEASE 〜 #endif のように使用します。
                       現状は有効にするとbootleg版のゲームが起動できるように
                       なります。

・バージョンの設定

VERSION_MAJOR = 2      メジャーバージョンは大規模な更新を行った場合に変更を行います。

VERSION_MINOR = 2      マイナーバージョンは小規模な更新を行った場合に変更を行います。
                       また、偶数の場合は安定版、奇数の場合は開発版となります。
                       したがって、ver.1.0の次はver.1.2がリリースバージョンになります。

VERSION_BUILD = 0      ビルド番号は細かいバグ修正を行った場合に変更を行います。

----------------------------------------------------------------------------------------

※homehook.prxについて

  カーネルモードで動作するHomeボタン読み取り専用のスレッドを実行するPRXです。
  一応、sceKernelDevkitVersion()で得られる値を渡すことで、旧カーネルでも動作するのですが、
  旧カーネルだとHomeボタンを押したときのアプリケーション終了ダイアログも開いてしまって
  使用できません。ダイアログを停止させる方法をご存知の方は修正してみてください。

  コンパイル方法は、homehookprxフォルダに移動してmakeです。

  なお、コンパイル終了時にnjemuのsrc/pspに一部ファイルをし、一つ上の階層にprxをコピー
  します。

----------------------------------------------------------------------------------------

※AdHoc用のPSPSDKのヘッダファイルについて

  現在のPSPSDKでは、ファイル毎に引数の型が変わっていてちょっと問題があったため、
  統一したものをsrc/psp/adhoc_includeに格納し、そちらを参照するようにしています。

  なお、AdHoc自体の動作確認は行っていないため、以前より悪くなっているかもしれません。
  旧バージョンのソースコードも参照してください。

----------------------------------------------------------------------------------------

※ver.2.2.2での変更点

・UIの描画を全てGUで行うように変更。GUを使用することで、16bitと32bitカラーの関数をほぼ
  共有することが出来るようになりました。

・MAME 0.119までのROMセットで対応漏れがあったため、修正。

・PSP-2000でスリープを実行すると0xbc00000以降のメモリがクリアされる問題に対処しました。
  スリープ時にメモリスティックにこれ以降のアドレスを退避しますので、空きメモリが4MB以上
  必要になります。

・英語版と日本語版のバイナリを統合。PSP本体の表示言語が日本語の場合は日本語で、それ以外
  は英語です。

・PSP-2000でHomeボタンを使用可能にしました。メニューは以前と同じくHomeボタンで開きます。

・初期化時のVRAMのクリア範囲が間違っていたので修正。

CPS1PSP
・psp-gcc-4.1.0でコンパイルするとスーパーマッスルボマーが起動できないため、
  psp-gcc-4.0.2を使用するように変更。psp-gcc-4.0.2はbinフォルダに格納してあるものを
  使用するので、特に環境を変更する必要はありません。

・ファイナルファイトで対応し忘れていたROMセットがあったので修正。

・starsレイヤーの描画に問題があったので修正。

MVSPSP/NCDZPSP
  画面の割り込み処理を最新のMAME風に変更。以前よりも精度が向上し、多少割り込み処理が
  軽くなっています。


※ver.2.2.1での変更点

・file_open()で変な処理を行っていたので修正。

・キャッシュでPSP-2000の拡張メモリを使用する場合に、メモリの範囲を指定せずに
  クリアを行っていたため、データが破壊されていた不具合を修正。


※ver.2.2.0での変更点

ソースの構造自体は特に大きな変更は行っていません。
動作確認が甘いので、うまく動作しない場合は2.0.6のソースコードと変更点を
比較して修正を行っていただけると助かります。

・CPS2PSPとMVSPSPをPSP-2000の拡張されたメモリに対応。
  CPS2PSPはキャッシュ不要で動作するようになります。
  MVSPSPは従来どおりキャッシュを作成する必要があります。
  (PSP_SLIMフラグを有効にしてコンパイルすること)

・MAME 0.119までに追加されたROMセットに対応。

・MAME Plus!で対応しているbootlegセットを追加。(REREASEフラグ無効でコンパイルすること)

・ver.2.0.6でいくつかの細かいバグがあったので修正。

・PSPSDKを最新版に更新したところコンパイル不能になっていたため、型定義の表記を
  従来のu8、u16等からMAMEのUINT8、UINT16等の表記に変更。
